<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #searchInput {
            width: 100%;
            padding: 10px;
            font-size: 16px;
        }
        #suggestions {
            border: 1px solid #ccc;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        .suggestion-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .suggestion-item img {
            max-width: 50px;
            margin-right: 10px;
        }
        .suggestion-item button {
            padding: 5px 10px;
            background-color: green;
            color: white;
            border: none;
            cursor: pointer;
        }
        .suggestion-item button:hover {
            background-color: darkgreen;
        }
    </style>
</head>
<body>

<h1>Product Search</h1>
<input type="text" id="searchInput" placeholder="Search for products..." oninput="searchProducts()" />

<div id="suggestions"></div>

<script>
    // Používáme corsproxy.io pro obcházení CORS
    const proxyUrl = 'https://corsproxy.io/?';
    const xmlUrl = 'https://www.henrymorgan.cz/export-full-products-TGp7rYDROL.xml';

    let products = [];

    async function loadXML() {
        try {
            const response = await fetch(proxyUrl + encodeURIComponent(xmlUrl));
            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.text();  // Získáme data jako text
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(data, "application/xml");
            parseProducts(xmlDoc);
        } catch (error) {
            console.error('Error fetching the XML file:', error);
        }
    }

    function parseProducts(xmlDoc) {
        const items = xmlDoc.getElementsByTagName("SHOPITEM");
        for (let i = 0; i < items.length; i++) {
            const product = {
                title: items[i].getElementsByTagName("PRODUCTNAME")[0].textContent,
                description: items[i].getElementsByTagName("DESCRIPTION")[0]?.textContent || '',
                shortDescription: items[i].getElementsByTagName("SHORTDESCRIPTION")[0]?.textContent || '',
                price: items[i].getElementsByTagName("PRICE_VAT")[0].textContent,
                imageUrl: items[i].getElementsByTagName("IMGURL")[0]?.textContent || '',
                url: items[i].getElementsByTagName("URL")[0].textContent
            };
            products.push(product);
        }
    }

    function searchProducts() {
        const searchTerm = document.getElementById("searchInput").value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        const suggestionsContainer = document.getElementById("suggestions");
        suggestionsContainer.innerHTML = '';

        if (searchTerm.length < 3) {
            return;
        }

        const filteredProducts = products.filter(product => {
            const normalizedTitle = product.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            const normalizedDescription = product.description.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            const normalizedShortDescription = product.shortDescription.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            
            return normalizedTitle.includes(searchTerm) ||
                   normalizedDescription.includes(searchTerm) ||
                   normalizedShortDescription.includes(searchTerm);
        });

        filteredProducts.forEach(product => {
            const suggestionItem = document.createElement("div");
            suggestionItem.classList.add("suggestion-item");

            const productInfo = document.createElement("div");
            const productTitle = document.createElement("h4");
            productTitle.textContent = product.title;

            const productPrice = document.createElement("p");
            productPrice.textContent = `Price: ${product.price} Kč`;

            productInfo.appendChild(productTitle);
            productInfo.appendChild(productPrice);

            const productImage = document.createElement("img");
            productImage.src = product.imageUrl;

            const buyButton = document.createElement("button");
            buyButton.textContent = "Buy";
            buyButton.onclick = () => {
                window.location.href = product.url;
            };

            suggestionItem.appendChild(productImage);
            suggestionItem.appendChild(productInfo);
            suggestionItem.appendChild(buyButton);
            suggestionsContainer.appendChild(suggestionItem);
        });
    }

    // Načteme produkty při načtení stránky
    window.onload = loadXML;
</script>
fdsfdsfs
</body>
</html>
